#  name: ci/cd devops
#  on: 
#   push:
#     branches: [main]
#  jobs: 
#   build:
#     runs-on: self-hosted
#     steps:
#     - name: Checkout code 
#       uses: actions/checkout@v3

#     - name: Build and run containers  
#       run: |  
#         # Опционально: проверьте наличие файла
#         if [ ! -f Docker-compose.yaml ]; then
#           echo "❌ Docker-compose.yaml not found"
#           exit 1
#         fi
#         docker compose -f Docker-compose.yaml up --build
#         sleep 30
#         docker-compose ps

#     - name: Verify containers are running 
#       run: | 
#         if docker compose ps | grep -q "Up"; then 
#           echo "✅ All containers are running" 
#         else 
#           echo "❌ Some containers failed to start" 
#           docker compose logs 
#           exit 1 
#         fi  # +1 балл (Критерий 2) git
name: ci/cd devops
on: 
  push:
    branches: [main]
  workflow_dispatch:
    branches: [main]
jobs: 
  build:
    runs-on: self-hosted  # Для Windows 10 x64 (GitHub-hosted; если self-hosted, настройте runner на Windows 10)
    steps:
    - name: Checkout code 
      uses: actions/checkout@v3

    - name: Build and run containers  
      run: |
        docker compose -f Docker-compose.yaml up --build
        Start-Sleep -Seconds 30

    - name: "docker compose ps"
      run: docker compose ps   

    - name: Verify containers are running 
      run: |  # PowerShell по умолчанию на Windows
        $psOutput = docker compose ps
        if ($psOutput | Select-String -Quiet "Up") {
          Write-Host "✅ All containers are running"
        } else {
          Write-Host "❌ Some containers failed to start"
          docker compose logs
          exit 1
        }  # +1 балл (Критерий 2)